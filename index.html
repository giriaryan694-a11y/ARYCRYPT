<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ARYCRYPT üîí</title>
<style>
    body {
        background-color: black;
        color: #00ff00;
        font-family: 'Courier New', monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
    }
    h1 { margin-bottom: 10px; }
    input, button {
        background-color: black;
        color: #00ff00;
        border: 1px solid #00ff00;
        padding: 10px;
        margin: 5px;
        font-family: inherit;
        cursor: pointer;
    }
    button:hover {
        background-color: #00ff00;
        color: black;
    }
    .password-wrapper {
        display: flex;
        align-items: center;
    }
</style>
</head>
<body>
<h1>ARYENCRYPT üîí</h1>
<p>Made by Aryan</p>

<input type="file" id="fileInput">
<div class="password-wrapper">
    <input type="password" id="passwordInput" placeholder="Enter password">
    <button id="togglePassword">üëÅÔ∏è</button>
</div>
<button id="encryptBtn">Encrypt & Download (.ary)</button>
<button id="decryptBtn">Decrypt & Download</button>

<script>
    const fileInput = document.getElementById('fileInput');
    const passwordInput = document.getElementById('passwordInput');
    const encryptBtn = document.getElementById('encryptBtn');
    const decryptBtn = document.getElementById('decryptBtn');
    const togglePassword = document.getElementById('togglePassword');

    togglePassword.addEventListener('click', () => {
        passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
    });

    async function deriveKey(password, salt) {
        const enc = new TextEncoder();
        const keyMaterial = await crypto.subtle.importKey(
            "raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]
        );
        return crypto.subtle.deriveKey(
            { name: "PBKDF2", salt, iterations: 100000, hash: "SHA-256" },
            keyMaterial,
            { name: "AES-GCM", length: 256 },
            true,
            ["encrypt", "decrypt"]
        );
    }

    function safeFileName(name) {
        // Replace unsafe characters in filenames
        return name.replace(/[^a-zA-Z0-9_\-\.]/g, "_");
    }

    async function encryptFile() {
        const file = fileInput.files[0];
        const password = passwordInput.value;
        if (!file || !password) return alert("Select a file and enter a password!");

        const arrayBuffer = await file.arrayBuffer();
        const salt = crypto.getRandomValues(new Uint8Array(16));
        const key = await deriveKey(password, salt);
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const encrypted = await crypto.subtle.encrypt({ name: "AES-GCM", iv }, key, arrayBuffer);

        const blob = new Blob([salt, iv, new Uint8Array(encrypted)], { type: "application/octet-stream" });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = safeFileName(file.name) + ".ary";
        document.body.appendChild(a);
        a.click();
        a.remove();
    }

    async function decryptFile() {
        const file = fileInput.files[0];
        const password = passwordInput.value;
        if (!file || !password) return alert("Select a file and enter a password!");

        const buffer = await file.arrayBuffer();
        const salt = buffer.slice(0, 16);
        const iv = buffer.slice(16, 28);
        const data = buffer.slice(28);
        const key = await deriveKey(password, new Uint8Array(salt));

        try {
            const decrypted = await crypto.subtle.decrypt({ name: "AES-GCM", iv: new Uint8Array(iv) }, key, data);
            const blob = new Blob([decrypted]);
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            const originalName = file.name.replace(/\.ary$/, "");
            a.download = safeFileName(originalName);
            document.body.appendChild(a);
            a.click();
            a.remove();
        } catch {
            alert("Wrong password or corrupted file!");
        }
    }

    encryptBtn.addEventListener('click', encryptFile);
    decryptBtn.addEventListener('click', decryptFile);
</script>
</body>
</html>
